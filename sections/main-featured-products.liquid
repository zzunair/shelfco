{% comment %}
  Featured products section
{% endcomment %}

{%- liquid
  assign _colClassLayout = 'container px-0'
  assign _colClass = 'col-md-4 col-lg-4 col-sm-6 col-xs-6'
  assign product_class = 'item collection-product'
  assign product_list = section.settings.product_list
  assign product_limit = section.settings.products_to_limit | escape

  if product == empty
    assign onboarding = true
    assign title = 'general.accessibility.pick_your_product' | t
    assign vendor = 'general.accessibility.vendor' | t
    assign price = 'general.accessibility.zero_price' | t
  endif
-%}

<section
  id="{{ section.id }}"
  class="section-{{ section.id }}-padding collection-row border-top-0 section"
  data-section-id="{{ section.id }}"
  data-section-type="home-products"
  tabindex="0"
>
  <div class="{{ _colClassLayout }}">
    <div class="products-on-page">
      <!-- this variable is assigned to the value of the collection selected via the schema -->
      <div class="col-md-12 slider-load">
        <div class="slider-parent wow fadeIn" data-wow-delay="300ms">
          <!-- Header -->
          {% if section.settings.section_header != blank %}
            <div class="container px-0 featured-products-title">
              <h2 class="mb-3 text-left">{{ section.settings.section_header }}</h2>
            </div>
          {% endif %}
          <!-- /Header -->
          <div class="slider-container mobile-ready-padding" tabindex="-1">
            <div
              class="featured-products row {% if section.settings.product_list.count <= 2 %}featured-products-width{% else %}4_or_more{% endif %}"
              id="id_{{ section.id }}"
              tabindex="-1"
            >
              {% for product in product_list limit: product_limit %}
                {% render 'product-card',
                  collection: collection,
                  product: product,
                  product_class: product_class,
                  _colClass: _colClass,
                  show_rating: section.settings.show_rating,
                  show_second_img: section.settings.show_secondary_image,
                  show_quick_buy: section.settings.show_quick_buy
                %}
              {% else %}
                {% for i in (1..3) %}
                  <div class="col-lg-4 col-md-4">
                    {% render 'product-card-placeholder' %}
                  </div>
                {% endfor %}
              {% endfor %}
            </div>
            <div class="controls">
              <button role="button" aria-label="Previous" class="glider-prev prev-btn">{% render 'icon-prev' %}</button>
              <button role="button" aria-label="Next" class="glider-next next-btn">{% render 'icon-next' %}</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Featured products",
  "class": "main-featured-products",
  "settings": [
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 20
    },
    {
      "type": "text",
      "id": "section_header",
      "label": "Heading",
      "default": "Featured products"
    },
    {
      "type": "product_list",
      "id": "product_list",
      "label": "Select Products",
      "limit": 12
    },
    {
      "type": "header",
      "content": "Product Card"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Image ratio",
      "default": "adapt",
      "options": [
        {
          "value": "adapt",
          "label": "Adapt to image"
        },
        {
          "value": "square",
          "label": "Square"
        }
      ],
      "default": "square"
    },
    {
      "type": "range",
      "id": "products_to_limit",
      "label": "Product limit",
      "min": 1,
      "max": 12,
      "default": 3
    },
    {
      "type": "checkbox",
      "id": "show_quick_buy",
      "default": true,
      "label": "Show quick buy button"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "default": false,
      "label": "Show second image on hover"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "default": false,
      "label": "Show product rating",
      "info": "To display a rating, add a product rating app."
    }
  ],
  "presets": [
    {
      "name": "Featured products",
      "category": "Content",
      "settings": {
      }
    }
  ]
}
{% endschema %}

<script>
  //slide tab call
  document.addEventListener("DOMContentLoaded", function() {
      featuredProductSliderSectionInit{{ section.id | replace: '-','_' }}();
  });
  document.addEventListener("shopify:section:load", function(event) {
    if(event.detail.sectionId === '{{ section.id }}') {
      featuredProductSliderSectionInit{{ section.id | replace: '-','_' }}();
    }
  });
  document.addEventListener("shopify:section:unload", function(event) {
    if(event.detail.sectionId === '{{ section.id }}') {
      featuredProductSliderSectionInit{{ section.id | replace: '-','_' }}();
    }
  });
  document.addEventListener("shopify:section:reorder", function(event) {
    if(event.detail.sectionId === '{{ section.id }}') {
      featuredProductSliderSectionInit{{ section.id | replace: '-','_' }}();
    }
  });
  window.addEventListener('shopify:section:load', function(event) {
    if (event.detail.sectionId === '{{ section.id }}') {
      featuredProductSliderSectionInit{{ section.id | replace: '-','_' }}();
    }
  });
  function featuredProductSliderSectionInit{{ section.id | replace: '-','_' }}() {
    if(document.querySelector('#{{ section.id }} .featured-products') != null){
      var element = document.querySelector('#{{ section.id }} .featured-products');
      // Layout adjustmenst for tiny slider init
      var elementRef = document.querySelector('#{{ section.id }} .featured-products');
      var elementRef2 = document.querySelector('#{{ section.id }} .slider-load');
      var elementRefTitle = document.querySelector('#{{ section.id }} .featured-products-title');
      element.classList.remove('row');
      elementRef2.classList.remove('slider-load');
      elementRef2.classList.add('px-0');
      elementRefTitle.classList.remove('px-0');
      // END Layout adjustmenst for tiny slider init

      //select all slider parents
      var sliders = document.querySelectorAll('#{{ section.id }} .featured-products');
      //for each slide
      sliders.forEach(slider => {
        var slider = tns({
          container: slider,
          items: 1,
          slideBy: '1',
          nav: false,
          speed: 400,
          mode: 'carousel',
          prevButton: '#{{ section.id }} .prev-btn',
          nextButton: '#{{ section.id }} .next-btn',
          navPosition: 'bottom',
          autoplayButtonOutput: false,
          mouseDrag: true,
          autoplay: false,
          controls: true,
          freezable: true,
          touch: false,
          mouseDrag: false,
          preventScrollOnTouch: 'true',
          rewind: true,
          lazyload: true,
          center: false,
          loop: false,
          controlsContainer: '#{{ section.id }} .controls',
          onInit(info) {
            info.controlsContainer.setAttribute('tabindex', -1);
            info.nextButton.setAttribute('tabindex', -1);
            info.prevButton.setAttribute('tabindex', -1);
          },
          responsive: {
            480: {
              items: 1,
            },
            640: {
              items: 2,
            },
            768: {
              items: 3,
            }
          }
        });
      });
    }
  }
</script>

{% style %}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
  @media screen and (min-width: 640px) {
    .featured-products-width {
      width: 100% !important
    }
  }
{% endstyle %}
