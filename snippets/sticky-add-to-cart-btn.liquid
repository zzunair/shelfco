{%- liquid
  assign has_multiple_variants = false
  if product.variants.size > 1
    assign has_multiple_variants = true
  endif

  assign has_single_variant = false
  if product.options.size == 1
    assign has_single_variants = true
  endif

  assign has_stock_remaining = false
  if product.variants.inventory_quantity == 0
    assign has_stock_remaining = true
  endif

  assign has_multiple_options = false
  if product.options.size > 1
    assign has_multiple_options = true
  endif

  assign has_selected_variant = false
  if product.available
    assign has_selected_variant = true
  endif

  assign can_add_to_cart = false
  if has_selected_variant and product.selected_or_first_available_variant.available
    assign can_add_to_cart = true
  elsif has_multiple_variants == false and product.available
    assign can_add_to_cart = true
  endif

  assign hide_default_title = false
  if product.variants.size == 1 or product.variants.first.title contains 'Default Title'
    assign hide_default_title = true
  endif

  if has_multiple_variants
  assign variants_with_quantity_json = product.variants | json

  unless variants_with_quantity_json contains 'inventory_quantity'
    for variant in product.variants
      assign replace_hook_variant_id = '"id":' | append: variant.id
      assign replace_id_plus_inventory = replace_hook_variant_id | append: ',' | append: '"inventory_quantity":' | append: variant.inventory_quantity
      assign variants_with_quantity_json = variants_with_quantity_json | replace: replace_hook_variant_id, replace_id_plus_inventory
    endfor
  endunless

  assign data_variants = variants_with_quantity_json | url_param_escape
  endif

  assign current_variant = product.selected_or_first_available_variant
  assign current_selling_plan_allocation = current_variant.selected_selling_plan_allocation

  if current_selling_plan_allocation == nil and current_variant.requires_selling_plan == false
   assign current_selling_plan_allocation = current_variant.selling_plan_allocations | first
  endif
-%}
<!-- start product add to cart form -->
{% assign class = 'add-to-cart-form sticky-add-to-cart-form d-flex form-product-id-' | append: product.id  %}
{% form 'product', product, data-product-form: '', data-product-handle: product.handle, data-enable-history-state: 'true', class: class, data-variants: data_variants %}
<input id="js-product-id"
       class="js-variant-id js-variant-radio js-sticky-product-id"
       type="hidden"
       name="id"
       value="{% if has_selected_variant %}{{ product.selected_or_first_available_variant.id }}{% else %}{{ product.variants.first.id }}{% endif %}"
       data-inventory-tracking="{% if has_selected_variant and current_variant.inventory_management == 'shopify' %}1{% else %}0{% endif %}"
       data-inventory-policy="{% if current_variant.inventory_policy != 'continue' %}1{% else %}0{% endif %}"
       data-available="{% if current_variant.available %}1{% else %}0{% endif %}"
       data-inventory-quantity="{% if current_selling_plan_allocation == nil %}{{ product.selected_or_first_available_variant.inventory_quantity }}{% else %}1{% endif %}">
<input type="hidden" id="no-qty-selector" class="input-text qty text" min="1" max="1" name="quantity" value="1" autocomplete="off" aria-label="quantity">

<div class="d-flex w-100">
  {% if product.selling_plan_groups.size > 0 %}
  <input type="hidden" class="js-sticky-product-selling-plan" name="selling_plan" value="">
  {% endif %}
  <!-- sticky add to cart button -->
  <span class="d-inline-flex quick-form w-100" data-id="{{ product.id }}">
    <div class="add-to-cart__wrapper mt-0 w-100" {{ block.shopify_attributes }}>
      <div class="add-to-cart__submit w-wrapper pb-0">
        <div class="atc-container mb-0">
          <!-- add to cart button -->
          <button
            type="submit"
            name="add"
            class="btn btn-contact mb-0 mx-auto w-100 add-to-cart-button border"
            {% if current_variant.available == false %}disabled{% endif %} aria-label="{{ 'products.product.add_to_cart' | t }}" data-soldout="{{ btn_txt_soldout }}" data-add="{{ btn_txt }}">
            <span class="js-btn-cta js-sticky-cta" data-addbtn="{{ btn_txt }}" data-soldout="{{ btn_txt_soldout }}" data-offerbtn="{{ btn_txt_selling }}" data-adding-cart="{{ btn_adding }}" data-added-cart="{{ btn_added }}">
              {% if current_variant.available %}
              {{ 'products.product.add_to_cart' | t }}
              {% else %}
              {{ 'products.product.sold_out' | t }}
              {% endif %}
            </span>
            <!-- Loader -->
          </button>
          <!-- / add to cart button -->
        </div>
      </div>
    </div>
  </span>
</div>
<!-- sticky add to cart button -->
<!-- PRODUCT DATA FOR JS -->
<div class="currentVariantObject d-none">{{ current_variant | json }}</div>
{% endform %}
