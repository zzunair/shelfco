{%- comment -%}
  Renders rating star and count

  Accepts:
  - reviews: {Object} Reviews metafield object {{ product.metafields.reviews }} (required)
  - show_rating_count: {Boolean} Show the product rating count (optional). Default is set from {{ settings.show_rating_count }} (false)
  - single_star: {Boolean} Show the 5 star icons or only 1 with number
  - onboarding: {Boolean} Default: false

  Usage:
  {% render 'rating', reviews: product.metafields.reviews, show_rating_count: block.settings.show_rating_count, onboarding: false %}
{%- endcomment -%}

{% capture icon_star_empty %}
<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 51 48" class="icon icon-star icon-star--empty">
  <path fill="#dee2e6" stroke="#dee2e6" d="m25,1 6,17h18l-14,11 5,17-15-10-15,10 5-17-14-11h18z"/>
</svg>
{% endcapture %}

{% capture icon_star_full %}
<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 51 48" class="icon icon-star icon-star--full">
  <path fill="#212529" stroke="#212529" d="m25,1 6,17h18l-14,11 5,17-15-10-15,10 5-17-14-11h18z"/>
</svg>
{% endcapture %}

{%- liquid
  assign show_rating = false
  if reviews.rating.value != blank
    assign show_rating = true
    assign reviews_rating = reviews.rating.value.rating | round: 1
    assign reviews_rating_count = reviews.rating_count

    if reviews.rating_count == blank
      assign show_rating_count = false
    endif

    assign rating_label = 'general.accessibility.star_reviews_info' | t: rating_value: reviews.rating.value, rating_max: reviews.rating.value.scale_max

    if show_rating_count
      assign count_translation = 'general.accessibility.total_reviews' | t
      assign count_label_string = ', ' | append: reviews.rating_count | append: ' ' | append: count_translation
      assign rating_label = rating_label | append: count_label_string
    endif
  elsif onboarding
    assign show_rating = true
    assign reviews_rating = 5.0 | round: 1
    assign reviews_rating_count = 10
    assign rating_label = 'general.accessibility.star_reviews_info' | append: ' ' | append: 10
  endif

  assign percent = reviews_rating | divided_by: 5 | times: 100
-%}

  <!-- if there are review values in the metafield -->
  {% if show_rating %}
  <div class="product__rating d-flex w-100 py-0 {{ class2 }}" role="img" title="{{ rating_label }}" aria-label="{{ rating_label }}">
    {% if single_star %}
      <span class="product__rating__star" aria-hidden="true">
        <span class="product__rating__star__full">{{ icon_star_full }}</span>
      </span>
      <span class="product__rating__value">{{ reviews_rating | round: 1 }}</span>
   {% else %}
    <span class="product__rating__star" aria-hidden="true" style="--percent: {{ 100 | minus: percent }}%">
      <span class="product__rating__star__empty">
        {% for i in (1..5) %}
          {{ icon_star_empty }}
        {% endfor -%}
      </span>
      <span class="product__rating__star__full {{ class }}">
        {% for i in (1..5) %}
          {{ icon_star_full }}
        {% endfor %}
      </span>
    </span>
    <span class="product__rating__value" aria-hidden="false">{{ reviews_rating | round: 1 }}</span>
   {% endif %}

  <!-- show the amount of reviews submitted -->
  {% if show_rating_count %}
    <span class="product__rating__count">({{ reviews_rating_count }})</span>
  {% endif %}
</div>
{% endif %}
